<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Kerberos
        | Elasticsearch for Apache Hadoop [7.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [7.x]" /><link rel="up" href="reference.html" title="Elasticsearch for Apache Hadoop" /><link rel="prev" href="errorhandlers.html" title="Error Handlers" /><link rel="next" href="metrics.html" title="Hadoop Metrics" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/7.x" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.x" />
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
<meta name="yandex-verification" content="d8a47e95d0972434" />
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	 

    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="text/javascript">
  // -------------------- set language based on browser language --------------------
  var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

  if($.cookie("is_lang_detected") == undefined){
    if(locales[lang] != undefined && locales[lang] != currentlocale){
      locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
      $.cookie("is_lang_detected",true ,{ path: '/'}); 
      window.location = locale_lang_url;
    } 
  }
        
  // --------------------- end of set language based on browser language -----------------
  </script>

  

	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
<script src="/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>


<script type="text/javascript">
  var active;
  
  active = Math.random() < 1 //0.9 
  
  elasticApm.init({
    active: active,
    serviceName: "elastic-co-frontend",
    serverUrl: "https://elastic-co-apm-server.app.elstc.co"
  })

  var pageLoadName
  var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
  var parts = pathname.split('/');

  if (parts.length && parts[1] === 'blog') {
    if (parts.length === 2) {
      pageLoadName =  '/blog';
    }
    else if (parts[2] === 'category') {
      pageLoadName =  '/blog/category';
    }
    else if (parts[2] === 'archive') {
      pageLoadName =  '/blog/archive';
    }
    else {
      pageLoadName =  '/blog/detail';
    }
  }
  else if (parts.length && parts[1] === 'elasticon') {
    if (parts.length === 2) {
      pageLoadName =  '/elasticon';
    }
    else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/overview';
    }
    else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/video';
    }
  }
  else if (parts.length && parts[1] === 'guide') {
    pageLoadName =  '/guide';
  }
  else if (parts.length === 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos';
  }
  else if (parts.length > 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos/detail';
  }
  else if (parts.length > 2 && parts[1] === 'webinars') {
    pageLoadName =  '/webinars/detail';
  }
  else {
    pageLoadName =  window.location.pathname;
  }

  console.log('apm pageLoadName:', pageLoadName, parts)
  elasticApm.setTags({env:"production"});
  elasticApm.setInitialPageLoadName(pageLoadName);
</script>

<!-- Elastic APM -->


    <!-- Header Section -->
    
<header class="header-wrapper">
  



  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <div id="logo">
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/blta09706b1c5cc1e99/elastic-logo-mobile.svg" alt="elastic-logo-mobile">
              </a>
            </div>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>

            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                  
                  <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="#" data-value="/" id="locale-select">English</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/es/" data-value="/es/" id="locale-select">Español</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                  
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <div id="logo">
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt244a845f141977c3/elastic-logo.svg" alt="elastic-logo">
          </a>
        </div>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>

          <li class="hidden-xs lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
              
                
                  
                
              
              <li><a class="" href="#" data-value="/">English</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/es/" data-value="/es/">Español</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Elasticsearch for Apache Hadoop</a></span> » <span class="breadcrumb-node">Kerberos</span></div><div class="navheader"><span class="prev"><a href="errorhandlers.html">
              « 
              Error Handlers</a>
           
        </span><span class="next">
           
          <a href="metrics.html">Hadoop Metrics
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos"></a>Kerberos<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 6.7. </p></div></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Kerberos support for Elasticsearch for Apache Hadoop requires Elasticsearch 6.7 or greater</p></div></div><p>Securing Hadoop means using Kerberos. Elasticsearch supports Kerberos as an authentication method. While the use of
Kerberos is not required for securing Elasticsearch, it is a convenient option for those who already deploy Kerberos to secure their
Hadoop clusters. This chapter aims to explain the steps needed to set up elasticsearch-hadoop to use Kerberos authentication for Elasticsearch.</p><p>Elasticsearch for Apache Hadoop communicates with Elasticsearch entirely over HTTP. In order to support Kerberos authentication over HTTP, elasticsearch-hadoop uses
the <a class="ulink" href="https://tools.ietf.org/html/rfc4178" target="_top">Simple and Protected GSSAPI Negotiation Mechanism (SPNEGO)</a> to negotiate which
underlying authentication method to use (in this case, Kerberos) and to transmit the agreed upon credentials to the server.
This authentication mechanism is performed using the <a class="ulink" href="https://tools.ietf.org/html/rfc4559" target="_top">HTTP Negotiate</a> authentication
standard, where a request is sent to the server and a response is received back with a payload that further advances
the negotiation. Once the negotiation between the client and server is complete, the request is accepted and a
successful response is returned.</p><p>Elasticsearch for Apache Hadoop makes use of Hadoop’s user management processes; The Kerberos credentials of the current Hadoop user are used when
authenticating to Elasticsearch. This means that Kerberos authentication in Hadoop must be enabled in order for elasticsearch-hadoop to obtain a
user’s Kerberos credentials. In the case of using an integration that does not depend on Hadoop’s runtime (e.g. Storm),
additional steps may be required to ensure that a running process has Kerberos credentials available for authentication.
It is recommended that you consult the documentation of each framework that you are using on how to configure security.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-settings"></a>Setting up your environment<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This documentation assumes that you have already provisioned a Hadoop cluster with Kerberos authentication enabled
(required). The general process of deploying Kerberos and securing Hadoop is beyond the scope of this documentation.</p></div></div><p>Before starting, you will need to ensure that principals for your users are provisioned in your Kerberos deployment,
as well as service principals for each Elasticsearch node. To enable Kerberos authentication on Elasticsearch, it must be
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-kerberos-realm.html" target="_top">configured with a
Kerberos realm</a>. It is recommended that you familiarize yourself with how to configure Elasticsearch Kerberos realms so that you
can make appropriate adjustments to fit your deployment. You can find more information on how they work in the
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/kerberos-realm.html" target="_top">Elastic Stack documentation</a>.</p><p>Additionally, you will need to <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html" target="_top">
configure the API Key Realm</a> in Elasticsearch. Hadoop and other distributed data processing frameworks only authenticate with
Kerberos in the process that launches a job. Once a job has been launched, the worker processes are often cut off from
the original Kerberos credentials and need some other form of authentication. Hadoop services often provide mechanisms for
obtaining <span class="emphasis"><em>Delegation Tokens</em></span> during job submission. These tokens are then distributed to worker processes which use
the tokens to authenticate on behalf of the user running the job. Elasticsearch for Apache Hadoop obtains API Keys in order to provide tokens
for worker processes to authenticate with.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-settings-eshadoop"></a>Connector Settings<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The following settings are used to configure elasticsearch-hadoop to use Kerberos authentication:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.security.authentication</code> (default <code class="literal">simple</code>, or <code class="literal">basic</code> if <code class="literal">es.net.http.auth.user</code> is set)
</span></dt><dd>
Required. Similar to most Hadoop integrations, this property signals which method to use in order to authenticate with
Elasticsearch. By default, the value is <code class="literal">simple</code>, unless <code class="literal">es.net.http.auth.user</code> is set, in which case it will default to
<code class="literal">basic</code>. The available options for this setting are <code class="literal">simple</code> for no authentication, <code class="literal">basic</code> for basic http
authentication, <code class="literal">pki</code> if relying on certificates, and <code class="literal">kerberos</code> if Kerberos authentication over SPNEGO should be used.
</dd><dt><span class="term">
<code class="literal">es.net.spnego.auth.elasticsearch.principal</code> (default none)
</span></dt><dd>
Required if <code class="literal">es.security.authentication</code> is set to <code class="literal">kerberos</code>. Details the name of the service principal that the
Elasticsearch server is running as. This will usually be of the form <code class="literal">HTTP/node.address@REALM</code>. Since Elasticsearch is
distributed and should be using a service principal per node, you can use the <code class="literal">_HOST</code> pattern
(like so <code class="literal">HTTP/_HOST@REALM</code>) to have elasticsearch-hadoop substitute the address of the node it is communicating with at runtime. Note
that elasticsearch-hadoop will attempt to reverse resolve node IP addresses to hostnames in order to perform this substitution.
</dd><dt><span class="term">
<code class="literal">es.net.spnego.auth.mutual</code> (default false)
</span></dt><dd>
Optional. The SPNEGO mechanism assumes that authentication may take multiple back and forth request-response cycles for
a request to be fully accepted by the server. When a request is finally accepted by the server, the response contains a
payload that can be verified to ensure that the server is the principal they say they are. Setting this to <code class="literal">true</code>
instructs elasticsearch-hadoop to perform this mutual authentication, and to fail the response if it detects invalid credentials from
the server.
</dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-hadoop"></a>Kerberos on Hadoop<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-hadoop-requirements"></a>Requirements<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Before using Kerberos authentication to Elasticsearch, Kerberos authentication must be enabled in Hadoop.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hadoop-requirements-conf"></a>Configure elasticsearch-hadoop<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Elasticsearch for Apache Hadoop only needs <a class="link" href="kerberos.html#kerberos-settings-eshadoop" title="Connector Settings">a few settings</a> to configure Kerberos authentication. It is best to
set these properties in your <code class="literal">core-site.xml</code> configuration so that they can be obtained across your entire Hadoop
deployment, just like you would for turning on security options for services in Hadoop.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-xml">&lt;configuration&gt;
    ...
    &lt;property&gt;
        &lt;name&gt;es.security.authentication&lt;/name&gt;
        &lt;value&gt;kerberos&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.net.spnego.auth.elasticsearch.principal&lt;/name&gt;
        &lt;value&gt;HTTP/_HOST@REALM.NAME.HERE&lt;/value&gt;
    &lt;/property&gt;
    ...
&lt;/configuration&gt;</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-yarn"></a>Kerberos on YARN<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When applications launch on a YARN cluster, they send along all of their application credentials to the Resource
Manager process for them to be distributed to the containers. The Resource Manager has the ability to renew any tokens
in those credentials that are about to expire and to cancel tokens once a job has completed. The tokens from Elasticsearch have
a default lifespan of 7 days and they are not renewable. It is a best practice to configure YARN so that it is able to
cancel those tokens at the end of a run in order to lower the risk of unauthorized use, and to lower the amount of
bookkeeping Elasticsearch must perform to maintain them.</p><p>In order to configure YARN to allow it to cancel Elasticsearch tokens at the end of a run, you must add the elasticsearch-hadoop jar to the
Resource Manager’s classpath. You can do that by placing the jar on the Resource Manager’s local filesystem, and setting
the path to the jar in the <code class="literal">YARN_USER_CLASSPATH</code> environment variable. Once the jar is added, the Resource Manager will
need to be restarted.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">export YARN_USER_CLASSPATH=/path/to/elasticsearch-hadoop.jar</pre></div><p>Additionally, the connection information for elasticsearch-hadoop should be present in the Hadoop configuration,
preferably the <code class="literal">core-site.xml</code>. This is because when Resource Manager cancels a token, it does not take the job
configuration into account. Without the connection settings in the Hadoop configuration, the Resource Manager will not
be able to communicate to Elasticsearch in order to cancel the token.</p><p>Here is a few common security properties that you will need in order for the Resource Manager to contact Elasticsearch to cancel
tokens:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-xml">&lt;configuration&gt;
    ...
    &lt;property&gt;
        &lt;name&gt;es.nodes&lt;/name&gt;
        &lt;value&gt;es-master-1,es-master-2,es-master-3&lt;/value&gt; <a id="CO106-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.security.authentication&lt;/name&gt; <a id="CO106-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        &lt;value&gt;kerberos&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.net.spnego.auth.elasticsearch.principal&lt;/name&gt; <a id="CO106-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        &lt;value&gt;HTTP/_HOST@REALM&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.net.ssl&lt;/name&gt; <a id="CO106-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.net.ssl.keystore.location&lt;/name&gt; <a id="CO106-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
        &lt;value&gt;file:///path/to/ssl/keystore&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.net.ssl.truststore.location&lt;/name&gt; <a id="CO106-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
        &lt;value&gt;file:///path/to/ssl/truststore&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;es.keystore.location&lt;/name&gt; <a id="CO106-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
        &lt;value&gt;file:///path/to/es/secure/store&lt;/value&gt;
    &lt;/property&gt;
    ...
&lt;/configuration&gt;</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The addresses of some Elasticsearch nodes. These can be any nodes (or all of them) as long as they all belong to the same
cluster.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Authentication must be configured as <code class="literal">kerberos</code> in the settings.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of the Elasticsearch service principal is not required for token cancellation but having the property in the
<code class="literal">core-site.xml</code> is required for some integrations like Spark.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
SSL should be enabled if you are using a secured Elasticsearch deployment.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Location on the local filesystem to reach the SSL Keystore.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Location on the local filesystem to reach the SSL Truststore.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Location on the local filesystem to reach the <a class="link" href="security.html#keystore" title="Secure Settingsedit">elasticsearch-hadoop secure store for secure settings</a>.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-mr"></a>Kerberos with Map/Reduce<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Before launching your Map/Reduce job, you must add a delegation token for Elasticsearch to the job’s credential set. The
<code class="literal">EsMapReduceUtil</code> utility class can be used to do this for you. Simply pass your job to it before submitting it to the
cluster. Using the local Kerberos credentials, the utility will establish a connection to Elasticsearch, request an API Key, and
stow the key in the job’s credential set for the worker processes to use.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">Job job = Job.getInstance(getConf(), "My-Job-Name"); <a id="CO107-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

// Configure Job Here...

EsMapReduceUtil.initCredentials(job); <a id="CO107-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

if (!job.waitForCompletion(true)) { <a id="CO107-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    return 1;
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Creating a new job instance
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
EsMapReduceUtil obtains job delegation tokens for Elasticsearch
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Submit the job to the cluster
</p></td></tr></table></div><p>You can obtain the job delegation tokens at any time during the configuration of the Job object, as long as your elasticsearch-hadoop
specific configurations are set. It’s usually sufficient to do it right before submitting the job. You should only do
this once per job since each call will wastefully obtain another API Key.</p><p>Additionally, the utility is also compatible with the <code class="literal">mapred</code> API classes:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">JobConf jobConf = new JobConf(getConf()); <a id="CO108-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
jobConf.setJobName("My-Job-Name");

// Configure JobConf Here...

EsMapReduceUtil.initCredentials(jobConf); <a id="CO108-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

JobClient.runJob(jobConf).waitForCompletion(); <a id="CO108-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Creating a new job configuration
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Obtain Elasticsearch delegation tokens
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Submit the job to the cluster
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-hive"></a>Kerberos with Hive<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-hive-requirements"></a>Requirements<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Using Kerberos auth on Elasticsearch is only supported using HiveServer2.</p></div></div><p>Before using Kerberos authentication to Elasticsearch in Hive, Kerberos authentication must be enabled for Hadoop. Make sure you have
done all the required steps for <a class="link" href="kerberos.html#kerberos-hadoop-requirements" title="Requirements">configuring your Hadoop cluster</a> as well as the steps
for <a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">configuring your YARN services</a> before using Kerberos authentication for Elasticsearch.</p><p>Finally, ensure that Hive Security is enabled.</p><p>Since Hive relies on user impersonation in Elasticsearch it is advised that you familiarise yourself with
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/setting-up-authentication.html" target="_top">Elasticsearch authentication</a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/authorization.html" target="_top">authorization</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-hive-proxy"></a>Configure user impersonation settings for Hive<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Hive’s security model follows a proxy-based approach. When a client submits a query to a secured Hive server, Hive
authenticates the client using Kerberos. Once Hive is sure of the client’s identity, it wraps its own identity with a
<span class="emphasis"><em>proxy user</em></span>. The proxy user contains the client’s simple user name, but contains no credentials. Instead, it is
expected that all interactions are executed as the Hive principal impersonating the client user. This is why when
configuring Hive security, one must specify in the Hadoop configuration which users Hive is allowed to impersonate:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-xml">&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.hive.hosts&lt;/name&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.hive.groups&lt;/name&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;</pre></div><p>Elasticsearch <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/run-as-privilege.html" target="_top">supports user impersonation</a>,
but only users from certain realm implementations can be impersonated. Most deployments of Kerberos include other identity
management components like
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-ldap-realm.html" target="_top">LDAP</a> or
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-ad-realm.html" target="_top">Active Directory</a>.
In those cases, you can configure those realms in Elasticsearch to allow for user impersonation.</p><p>If you are only using Kerberos, or you are using a solution for which Elasticsearch does not support user impersonation, you must
mirror your Kerberos principals to either a
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/native-realm.html" target="_top">native realm</a> or a
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/file-realm.html" target="_top">file realm</a> in Elasticsearch. When mirroring a
Kerberos principal to one of these realms, set the new user’s username to just the main part of the principal name, without
any realm or host information. For instance, <code class="literal">client@REALM</code> would just be <code class="literal">client</code> and <code class="literal">someservice/domain.name@REALM</code>
would just be <code class="literal">someservice</code>.</p><p>You can follow this step by step process for mirroring users:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hive-proxy-user-role"></a>Create End User Roles<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Create a role for your end users that will be querying Hive. In this example, we will make a simple role for accessing
indices that match <code class="literal">hive-index-*</code>. All our Hive users will end up using this role to read, write, and update indices
in Elasticsearch.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role/hive_user_role <a id="CO109-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
  "run_as": [],
  "cluster": ["monitor", "manage_token"], <a id="CO109-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  "indices": [
      {
        "names": [ "hive-index-*" ],  <a id="CO109-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "privileges": [ "read", "write", "manage" ]
      }
  ]
}</pre></div><div class="console_widget" data-snippet="snippets/kerberos/1.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Our example role name is <code class="literal">hive_user_role</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
User should be able to query basic cluster information and manage tokens.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Our user will be able to perform read write and management operations on an index.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hive-proxy-user-mapping"></a>Create role mapping for Kerberos user principal<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Now that the user role is created, we must map the Kerberos user principals to the role. Elasticsearch does not know the complete
list of principals that are managed by Kerberos. As such, each principal that wishes to connect to Elasticsearch must be mapped to
a list of roles that they will be granted after authentication.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST /_xpack/security/role_mapping/hive_user_1_mapping
{
  "roles": [ "hive_user_role" ], <a id="CO110-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "enabled": true,
  "rules": {
    "field" : { "username" : "hive.user.1@REALM" } <a id="CO110-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  }
}</pre></div><div class="console_widget" data-snippet="snippets/kerberos/2.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO110-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We set the roles for this mapping to be our example role <code class="literal">hive_user_role</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO110-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
When the user principal <code class="literal">hive.user.1@REALM</code> authenticates, it will be given the permissions from the
<code class="literal">hive_user_role</code>.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hive-proxy-user-mirror"></a>Mirror the user to the native realm<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>You may not have to perform this step if you are deploying
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-ldap-realm.html" target="_top">LDAP</a> or
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-ad-realm.html" target="_top">Active Directory</a> along
with Kerberos. Elasticsearch will perform user impersonation by looking up the user names in those realms as long as the simple
names (e.g. hive.user.1) on the Kerberos principals match the user names LDAP or Active Directory exactly.</p></div></div><p>Mirroring the user to the native realm will allow Elasticsearch to accept authentication requests from the original principal
as well as accept requests from Hive which is impersonating the user. You can create a user in the native realm like
so:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_xpack/security/user/hive.user.1 <a id="CO111-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
  "enabled" : true,
  "password" : "swordfish", <a id="CO111-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  "roles" : [ "hive_user_role" ], <a id="CO111-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
  "metadata" : {
    "principal" : "hive.user.1@REALM" <a id="CO111-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
  }
}</pre></div><div class="console_widget" data-snippet="snippets/kerberos/3.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The user name is <code class="literal">hive.user.1</code>, which is the simple name format of the <code class="literal">hive.user.1@REALM</code> principal we are
mirroring.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Provide a password here for the user. This should ideally be a securely generated random password since this
mirrored user is just for impersonation purposes.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Setting the user’s roles to be the example role <code class="literal">hive_user_role</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This is not required, but setting the original principal on the user as metadata may be helpful for your own
bookkeeping.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hive-proxy-service-role"></a>Create a role to impersonate Hive users<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Once you have configured Elasticsearch with a role mapping for your Kerberos principals and native users for impersonation, you
must create a role that Hive will use to impersonate those users.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role/hive_proxier
{
  "run_as": ["hive.user.1"] <a id="CO112-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
}</pre></div><div class="console_widget" data-snippet="snippets/kerberos/4.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Hive’s proxy role should be limited to only run as the users who will be using Hive.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-hive-proxy-service-mapping"></a>Create role mapping for Hive’s service principal<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Now that there are users to impersonate, and a role that can impersonate them, make sure to map the Hive principal to
the proxier role, as well as any of the roles that the users it is impersonating would have. This allows the Hive
principal to create and read indices, documents, or do anything else its impersonated users might be able to do.
While Hive is impersonating the user, it must have these roles or else it will not be able to fully impersonate that
user.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST /_xpack/security/role_mapping/hive_hiveserver2_mapping
{
  "roles": [
    "hive_user_role", <a id="CO113-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "hive_proxier" <a id="CO113-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  ],
  "enabled": true,
  "rules": {
    "field" : { "username" : "hive/hiveserver2.address@REALM" } <a id="CO113-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
  }
}</pre></div><div class="console_widget" data-snippet="snippets/kerberos/5.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Here we set the roles to be the superset of the roles from the users we want to impersonate. In our example, the
<code class="literal">hive_user_role</code> role is set.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The role that allows Hive to impersonate Hive end users.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of the Hive server principal to match against.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If managing Kerberos role mappings via the API’s is not desired, they can instead be managed in a
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/mapping-roles.html#mapping-roles-file" target="_top">role mapping file</a>.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-hive-running"></a>Running your Hive queries<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Once all user accounts are configured and all previous steps for enabling Kerberos auth in Hadoop and Hive are complete,
there should be no differences in creating Hive queries from before.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-pig"></a>Kerberos with Pig<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-pig-requirements"></a>Requirements<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Before using Kerberos authentication to Elasticsearch in Pig, Kerberos authentication must be enabled for Hadoop. Make sure you have
done all the required steps for <a class="link" href="kerberos.html#kerberos-hadoop-requirements" title="Requirements">configuring your Hadoop cluster</a> as well as the steps
for <a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">configuring your YARN services</a> before using Kerberos authentication for Elasticsearch.</p><p>If elasticsearch-hadoop is configured for Kerberos authentication and Hadoop security is enabled, elasticsearch-hadoop’s storage functions in Pig will
automatically obtain delegation tokens for jobs when submitting them to the cluster.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-spark"></a>Kerberos with Spark<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-spark-requirements"></a>Requirements<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Using Kerberos authentication in elasticsearch-hadoop for Spark has the following requirements:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Your Spark jobs must be deployed on YARN. Using Kerberos authentication in elasticsearch-hadoop does not support any other Spark cluster
deployments (Mesos, Standalone).
</li><li class="listitem">
Your version of Spark must be on or above version 2.1.0. It is this version that Spark added the ability to plug in
third-party credential providers to obtain delegation tokens.
</li></ol></div><p>Before using Kerberos authentication to Elasticsearch in Spark, Kerberos authentication must be enabled for Hadoop. Make sure you have
done all the required steps for <a class="link" href="kerberos.html#kerberos-hadoop-requirements" title="Requirements">configuring your Hadoop cluster</a> as well as the steps
for <a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">configuring your YARN services</a> before using Kerberos authentication for Elasticsearch.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-spark-credprovider"></a>EsServiceCredentialProvider<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Before Spark submits an application to a YARN cluster,
<a class="ulink" href="https://spark.apache.org/docs/2.1.0/running-on-yarn.html#running-in-a-secure-cluster" target="_top">it loads a number of
credential provider implementations</a> that are used to determine if any additional credentials must be obtained before
the application is started. These implementations are loaded using Java’s <code class="literal">ServiceLoader</code> architecture. Thus, any jar
that is on the classpath when the Spark application is submitted can offer implementations to be loaded and used.
<code class="literal">EsServiceCredentialProvider</code> is one such implementation that is loaded whenever elasticsearch-hadoop is on the job’s classpath.</p><p>Once loaded, <code class="literal">EsServiceCredentialProvider</code> determines if Kerberos authentication is enabled for elasticsearch-hadoop. If it is determined
that Kerberos authentication is enabled for elasticsearch-hadoop, then the credential provider will automatically obtain delegation tokens
from Elasticsearch and add them to the credentials on the YARN application submission context. Additionally, in the case that
the job is a long lived process like a Spark Streaming job, the credential provider is used to update or obtain new
delegation tokens when the current tokens approach their expiration time.</p><p>The time that Spark’s credential providers are loaded and called depends on the cluster deploy mode when submitting your
Spark app. When running in <code class="literal">client</code> deploy mode, Spark runs the user’s driver code in the local JVM, and launches the
YARN application to oversee the processing as needed. The providers are loaded and run whenever the YARN application
first comes online. When running in <code class="literal">cluster</code> deploy mode, Spark launches the YARN application immediately, and the
user’s driver code is run from the resulting Application Master in YARN. The providers are loaded and run <span class="emphasis"><em>immediately</em></span>,
before any user code is executed.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-spark-credprovider-conf"></a>Configuring the credential provider<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>All implementations of the Spark credential providers use settings from only a few places:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
The entries from the local Hadoop configuration files
</li><li class="listitem">
The entries of the local Spark configuration file
</li><li class="listitem">
The entries that are specified from the command line when the job is initially launched
</li></ol></div><p>Settings that are configured from the user code are not used because the provider must run once for all jobs that are
submitted for a particular Spark application. User code is not guaranteed to be run before the provider is loaded.
To make things more complicated, a credential provider is only given the local Hadoop configuration to determine if
they should load delegation tokens.</p><p>These limitations mean that the settings to configure elasticsearch-hadoop for Kerberos authentication need to be in specific places:</p><p>First, <code class="literal">es.security.authentication</code> MUST be set in the local Hadoop configuration files as <span class="emphasis"><em>kerberos</em></span>. If it is not set
in the Hadoop configurations, then the credential provider will assume that <span class="emphasis"><em>simple</em></span> authentication is to be used, and
will not obtain delegation tokens.</p><p>Secondly, all general connection settings for elasticsearch-hadoop (like <code class="literal">es.nodes</code>, <code class="literal">es.ssl.enabled</code>, etc…) must be specified either
<a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">in the local Hadoop configuration files</a>, in the local Spark configuration file, or from the command
line. If these settings are not available here, then the credential provider will not be able to contact Elasticsearch in order
to obtain the delegation tokens that it requires.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">$&gt; bin/spark-submit \
    --class org.myproject.MyClass \
    --master yarn \
    --deploy-mode cluster \
    --jars path/to/elasticsearch-hadoop.jar \
    --conf 'spark.es.nodes=es-node-1,es-node-2,es-node-3' <a id="CO114-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    --conf 'spark.es.ssl.enabled=true'
    --conf 'spark.es.net.spnego.auth.elasticsearch.principal=HTTP/_HOST@REALM' <a id="CO114-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    path/to/jar.jar</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO114-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An example of some connection settings specified at submission time
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO114-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Be sure to include the Elasticsearch service principal.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Specifying this many configurations in the spark-submit command line is a pretty sure fire way to miss important
settings. Thus, it is advised to set them in the <a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">cluster wide Hadoop config</a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-spark-credprovider-streaming"></a>Renewing credentials for streaming jobs<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In the event that you are running a streaming job, it is best to use the <code class="literal">cluster</code> deploy mode to allow YARN to
manage running the driver code for the streaming application.</p></div></div><p>Since streaming jobs are expected to run continuously without stopping, you should configure Spark so that the
credential provider can obtain new tokens before the original tokens expire.</p><p>Configuring Spark to obtain new tokens is different from <a class="link" href="kerberos.html#kerberos-yarn" title="Kerberos on YARN">configuring YARN to renew and cancel tokens</a>. YARN can only renew existing tokens up to their maximum lifetime. Tokens from Elasticsearch are not renewable.
Instead, they have a simple lifetime of 7 days. After those 7 days elapse, the tokens are expired. In order for
an ongoing streaming job to continue running without interruption, completely new tokens must be obtained and
sent to worker tasks. Spark has facilities for automatically obtaining and distributing completely new tokens
once the original token lifetime has ended.</p><p>When submitting a Spark application on YARN, users can provide a principal and keytab file to the <code class="literal">spark-submit</code>
command. Spark will log in with these credentials instead of depending on the local Kerberos TGT Cache for the current
user. In the event that any delegation tokens are close to expiring, the loaded credential providers are given the
chance to obtain new tokens using the given principal and keytab before the current tokens fully expire. Any new tokens
are automatically distributed by Spark to the containers on the YARN cluster.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">$&gt; bin/spark-submit \
    --class org.myproject.MyClass \
    --master yarn \ <a id="CO115-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    --deploy-mode cluster \ <a id="CO115-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    --jars path/to/elasticsearch-hadoop.jar \
    --principal client@REALM <a id="CO115-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    --keytab path/to/keytab.kt \ <a id="CO115-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    path/to/jar.jar</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO115-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
YARN deployment is required for Kerberos
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO115-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Use cluster deploy mode to allow for the driver to be run in the YARN Application Master
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO115-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the principal to run the job as
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO115-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path to the keytab that will be used to reauthenticate when credentials expire
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-spark-credprovider-disable"></a>Disabling the credential provider<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When elasticsearch-hadoop is on the classpath, <code class="literal">EsServiceCredentialProvider</code> is ALWAYS loaded by Spark. If Kerberos authentication is
enabled for elasticsearch-hadoop in the local Hadoop configuration, then the provider will attempt to load delegation tokens for Elasticsearch
regardless of if they are needed for that particular job.</p><p>It is advised that you do not add elasticsearch-hadoop libraries to jobs that are not configured to connect to or interact with Elasticsearch.
This is the easiest way to avoid the confusion of unrelated jobs failing to launch because they cannot connect to Elasticsearch.</p><p>If you find yourself in a place where you cannot easily remove elasticsearch-hadoop from the classpath of jobs that do not need to
interact with Elasticsearch, then you can explicitly disable the credential provider by setting a property at launch time.
The property to set is dependent on your version of Spark:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
For Spark 2.3.0 and up: set the <code class="literal">spark.security.credentials.elasticsearch.enabled</code> property to <code class="literal">false</code>.
</li><li class="listitem">
For Spark 2.1.0-2.3.0: set the <code class="literal">spark.yarn.security.credentials.elasticsearch.enabled</code> property to <code class="literal">false</code>. This
property is still accepted in Spark 2.3.0+, but is marked as deprecated.
</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos-storm"></a>Kerberos with Storm<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-storm-requirements"></a>Requirements<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Your Storm deployment should be secured, but configuring it for security is not strictly required.</p><p>Storm is not always deployed alongside a Hadoop distribution. Thus, configuring Kerberos authentication for Hadoop is not
required for using Kerberos authentication to Elasticsearch on Storm.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kerberos-storm-autocred"></a>Using Storm’s AutoCredential plugins<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Storm provides a <a class="ulink" href="http://storm.apache.org/releases/2.0.0-SNAPSHOT/SECURITY.html#automatic-credentials-push-and-renewal" target="_top">
myriad of plugin interfaces</a> that can be loaded and used to collect, update, and renew credentials over the lifetime of
a running topology. elasticsearch-hadoop provides the <code class="literal">AutoElasticsearch</code> class which Storm can use to automatically obtain and renew
Elasticsearch delegation tokens for a topology.</p><p><code class="literal">AutoElasticsearch</code> implements Storm’s <code class="literal">INimbusCredentialPlugin</code>, <code class="literal">IAutoCredentials</code>, and <code class="literal">ICredentialsRenewer</code>
interfaces. The first of which is used to obtain delegation tokens on Nimbus before submitting a topology. The second
is used for updating the credentials on the worker nodes, and the third is used for obtaining new delegation tokens
when the current tokens are close to expiring.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-storm-autocred-settings"></a>Configuring AutoElasticsearch<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In order for the <code class="literal">AutoElasticsearch</code> plugin to obtain credentials, Kerberos authentication must be enabled for elasticsearch-hadoop in its
settings. You must specify the <code class="literal">es.security.authentication</code> setting in either the storm.yaml file or on the topology
configuration.</p><p>The <code class="literal">AutoElasticsearch</code> plugin provides two settings for denoting the principal and keytab to be used when executing:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.storm.autocredentials.user.principal</code> (default none)
</span></dt><dd>
Required. The principal that the plugin should use for obtaining credentials for this topology. Can be set in the storm.yaml
configuration or in the topology configuration.
</dd><dt><span class="term">
<code class="literal">es.storm.autocredentials.user.keytab</code> (default none)
</span></dt><dd>
Required. The path to the keytab on Nimbus that will be used for logging in as the given principal. This can be set in the
storm.yaml configuration or in the topology configuration. The file must exist on Nimbus.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-storm-autocred-nimbus"></a>Configuring Nimbus<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Nimbus must be configured to use <code class="literal">AutoElasticsearch</code> as a credential plugin from the <code class="literal">storm.yaml</code> configuration file.
It is safe to specify <code class="literal">AutoElasticsearch</code> in these settings even if your topology does not interact with Elasticsearch. The
plugin will perform no operations unless <code class="literal">AutoElasticsearch</code> is explicitly enabled on the topology.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">nimbus.autocredential.plugins.classes: ["org.elasticsearch.storm.security.AutoElasticsearch"] <a id="CO116-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
nimbus.credential.renewers.classes: ["org.elasticsearch.storm.security.AutoElasticsearch"] <a id="CO116-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
nimbus.credential.renewers.freq.secs: 30 <a id="CO116-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO116-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The list of auto credential plugins to be run on Nimbus when submitting a topology
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO116-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The list of all the credential renewers available for Nimbus to run
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO116-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The frequency at which the credential renewers on Nimbus should be executed to check and update credentials.
</p></td></tr></table></div><p>In order for the plugin to be loaded, elasticsearch-hadoop must be present on the Nimbus classpath. You can add it to the classpath by
using an environment variable on Nimbus.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">export STORM_EXT_CLASSPATH=/path/to/elasticsearch-hadoop.jar</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="kerberos-storm-autocred-topology"></a>Configuring topologies<a href="https://github.com/elastic/elasticsearch-hadoop/edit/7.x/docs/src/reference/asciidoc/core/kerberos.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Once Nimbus is configured, you must add <code class="literal">AutoElasticsearch</code> to your topology configuration in order for delegation
tokens to be obtained and updated. If you do not specify it in the topology configuration, then Storm will not attempt
to obtain Elasticsearch delegation tokens when the topology is submitted.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">Config conf = new Config();
List plugins = new ArrayList();
plugins.add(AutoElasticsearch.class.getName());
conf.put(Config.TOPOLOGY_AUTO_CREDENTIALS, plugins); <a id="CO117-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
...
conf.put(ConfigurationOptions.ES_SECURITY_AUTHENTICATION, "kerberos"); <a id="CO117-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
conf.put(ConfigurationOptions.ES_NET_SPNEGO_AUTH_ELASTICSEARCH_PRINCIPAL, "HTTP/elasticsearch.node.address@REALM");
...</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Configure the topology with <code class="literal">AutoElasticsearch</code> as one of the auto credential plugins for the topology. This list
of plugins may contain other auto credential plugins if you have need of them.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If you have not enabled Kerberos authentication for elasticsearch-hadoop in the storm.yaml configuration file, you will need to set
the properties here.
</p></td></tr></table></div></div></div></div></div><div class="navfooter"><span class="prev"><a href="errorhandlers.html">
              « 
              Error Handlers</a>
           
        </span><span class="next">
           
          <a href="metrics.html">Hadoop Metrics
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack">Stack Features (formerly X-Pack)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/security">Security</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/alerting">Alerting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/canvas">Canvas</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/monitoring">Monitoring</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/elasticsearch-sql">Elasticsearch SQL</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">Elasticsearch-Hadoop</a></li>
                  
                
              
                
                  
                    <li><a href="/products/ece">Elastic Cloud Enterprise</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
                
                  
                    <li><a href="/google-site-search-alternative">Google Site Search Alternative</a></li>
                  
                
              
              </ul>
              
                <h3><a href="/cloud">Elastic Cloud ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/cloud/elasticsearch-service">Elasticsearch Service</a></li>
                  
                
              
                
                  
                    <li><a href="/aws-elasticsearch-service">AWS Elasticsearch Service Comparison</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/app-search-service">Elastic App Search Service</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/site-search-service">Elastic Site Search Service</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
              
                <h3></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/about/our-source-code">Our Source Code</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams">Teams</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/board">Board of Directors</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/history-of-elasticsearch">Our Story</a></li>
                  
                
              
                
                  
                    <li><a href="/about/why-open-source">Why Open Source</a></li>
                  
                
              
                
                  
                    <li><a href="/about/distributed">Distributed by Intention</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Media</a></li>
                  
                
              
                
                  
                    <li><a href="https://ir.elastic.co">Investor Relations</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="Facebook"><a id="footer_facebook" href="https://www.facebook.com/elastic.co">Facebook</a></li>
          
          		 	<li class="Twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic">Twitter</a></li>
          
          		 	<li class="LinkedIn"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co">LinkedIn</a></li>
          
          		 	<li class="Xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co">Xing</a></li>
          
          		 	<li class="YouTube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch">YouTube</a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-statement">Privacy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-text">
					<p>© 2019. Elasticsearch B.V. All Rights Reserved
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
